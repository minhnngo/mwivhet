% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calc_terms_loop.R
\name{A1type_iloop_sum}
\alias{A1type_iloop_sum}
\title{Compute Generalized A1-Type Variance Component}
\usage{
A1type_iloop_sum(df, P, G, ipos, jpos, kpos, lpos, noisy = FALSE)
}
\arguments{
\item{df}{Data frame. Contains the data vectors specified by \code{ipos}, \code{jpos},
\code{kpos}, and \code{lpos}.}

\item{P}{Matrix of dimension \eqn{n \times n}. The projection matrix of instruments.}

\item{G}{Matrix of dimension \eqn{n \times n}. The UJIVE weighting matrix.}

\item{ipos}{Name of the column in \code{df} (unquoted) corresponding to the outer summation weight \eqn{i}.}

\item{jpos}{Name of the column in \code{df} (unquoted) corresponding to the inner summation term \eqn{j}.}

\item{kpos}{Name of the column in \code{df} (unquoted) corresponding to the inner summation term \eqn{k}.}

\item{lpos}{Name of the column in \code{df} (unquoted) corresponding to the bias correction/residual term.}

\item{noisy}{Logical. If \code{TRUE}, prints progress to the console.}
}
\value{
A numeric scalar representing the computed sum.
}
\description{
Calculates a variance component structured like the \eqn{A_1} term in the L3O variance
estimator, allowing for arbitrary vectors in the summation positions. This generalized
function is used to compute \eqn{A_1}, \eqn{A_2}, and \eqn{A_3} by permuting the
input vectors (e.g., swapping regressors \eqn{X} and residuals \eqn{e}).
}
\details{
This function computes the scalar:
\deqn{S = \sum_{i} v_i^{(I)} \left[ v_i^{(L)} \sum_{j \neq i} \sum_{k \neq i} G_{ij} v_j^{(J)} G_{ik} v_k^{(K)} W_{ijk} - \text{BiasCorrect}(v^{(L)}, v^{(J)}, v^{(K)}) \right]}
where \eqn{v^{(I)}, v^{(J)}, v^{(K)}, v^{(L)}} correspond to the vectors specified by
\code{ipos}, \code{jpos}, \code{kpos}, and \code{lpos} respectively. \eqn{W_{ijk}} represents
the Leave-Three-Out weighting derived from the annihilator matrix \eqn{M = I-P}.

The function implements the bias correction expansion (terms \eqn{A_{12}} through \eqn{A_{15}})
required for consistency under many weak instruments.
}
