% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calc_terms_loop.R
\name{A2type_iloop_sum}
\alias{A2type_iloop_sum}
\title{Compute Generalized A2-Type Variance Component}
\usage{
A2type_iloop_sum(df, P, G, ipos, jpos, kpos, lpos, noisy = FALSE)
}
\arguments{
\item{df}{Data frame. Contains the data vectors specified by \code{ipos}, \code{jpos},
\code{kpos}, and \code{lpos}.}

\item{P}{Matrix of dimension \eqn{n \times n}. The projection matrix of instruments.}

\item{G}{Matrix of dimension \eqn{n \times n}. The UJIVE weighting matrix.}

\item{ipos}{Name of the column in \code{df} (unquoted) corresponding to the outer summation weight \eqn{i}.}

\item{jpos}{Name of the column in \code{df} (unquoted) corresponding to the inner summation term \eqn{j}.}

\item{kpos}{Name of the column in \code{df} (unquoted) corresponding to the inner summation term \eqn{k}.}

\item{lpos}{Name of the column in \code{df} (unquoted) corresponding to the bias correction/residual term.}

\item{noisy}{Logical. If \code{TRUE}, prints progress to the console.}
}
\value{
A numeric scalar.
}
\description{
Calculates a variance component structurally equivalent to the \eqn{A_2} term in the
L3O variance estimator. This function handles asymmetric weighting structures where
the summation involves terms of the form \eqn{G_{ij} G_{ki}} (chaining indices),
differing from the symmetric \eqn{G_{ij} G_{ik}} form calculated by \code{A1type_iloop_sum}.
}
\details{
This function computes the scalar:
\deqn{S = \sum_{i} v_i^{(I)} \left[ v_i^{(L)} \sum_{j \neq i} \sum_{k \neq i} G_{ij} v_j^{(J)} G_{ki} v_k^{(K)} W_{ijk} - \text{BiasCorrect} \right]}
where \eqn{v^{(I)}, v^{(J)}, v^{(K)}, v^{(L)}} correspond to the input vectors.

The primary distinction from \code{A1type_iloop_sum} is the use of \eqn{G_{ki}} (the \eqn{i}-th element of column \eqn{k}, or row \eqn{k} column \eqn{i})
in the second position, rather than \eqn{G_{ik}}. This asymmetric structure is required
for interaction terms in the variance of the score statistic (e.g., \eqn{A_2} and \eqn{A_5} in Yap 2025).
}
\references{
Yap, L. (2025). "Inference with Many Weak Instruments and Heterogeneity". Working Paper.
}
